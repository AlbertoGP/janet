image: openbsd/latest
sources:
- https://git.sr.ht/~bakpakin/janet
packages:
- gmake
- meson
tasks:
- build: |
    cd janet # Makefile testing on BSD.
    gmake
    gmake test
    doas gmake install
    gmake test-install
    doas gmake uninstall
    rm -rf build # clean up
    meson setup build --buildtype=release -Dsingle_threaded=true -Dnanbox=false -Ddynamic_modules=false -Ddocstrings=false -Dnet=false -Dsourcemaps=false -Dpeg=false -Dassembler=false -Dint_types=false -Dtyped_array=false -Dreduced_os=true # meson minimum build
    cd build
    ninja # will not pass tests but should build
    cd ..
    rm -rf build # clean up
    meson setup build --buildtype=release -Dprf=true # meson (with prf)
    cd build
    ninja
    ninja test
    cd ..
    rm -rf build
    meson setup build --buildtype=release # meson (default build)
    cd build
    ninja
    ninja test
    doas ninja install
    doas jpm --verbose install circlet

